(function () { var statcookie = function (name, value, options) { if (typeof value != 'undefined') { options = options || {}; if (value === null) { value = ''; options.expires = -1 }; var expires = ''; if (options.expires && (typeof options.expires == 'number' || options.expires.toUTCString)) { var date; if (typeof options.expires == 'number') { date = new Date(); if (options.model == 1) { date.setTime(date.getTime() + (options.expires * 1000)) } else { date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000)) } } else { date = options.expires }; expires = '; expires=' + date.toUTCString() }; var path = options.path ? '; path=' + (options.path) : ''; var domain = options.domain ? '; domain=' + (options.domain) : ''; var secure = options.secure ? '; secure' : ''; document.cookie = [name, '=', encodeURIComponent(value), expires, path, domain, secure].join('') } else { var cookieValue = ''; if (document.cookie && document.cookie != '') { var cookies = document.cookie.split(';'); for (var i = 0; i < cookies.length; i++) { cookie = cookies[i].replace(/^\s+|\s+$/g, ''); if (cookie.substring(0, name.length + 1) == (name + '=')) { cookieValue = decodeURIComponent(cookie.substring(name.length + 1)); break } } }; return cookieValue } }; var ajax = function (uri, callback) { var request = (window.XMLHttpRequest) ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP"); request.onreadystatechange = function () { var result = ''; if (request.readyState == 4 && request.status == 200) result = request.responseText; callback(result) }; request.open("GET", uri); request.send(null) }; var getParameter = function (argName) { var value = location.search.match(new RegExp('[\?\&]' + argName + '=([^\&]+)', 'i')); if (value == null || value.length < 1) return ''; return value[1] }; try { var c_guid = statcookie("xxsy_guid"); var l_guid = localStorage.getItem("xxsy_guid"); if ((l_guid == null || l_guid == "") && c_guid != null && c_guid != "") { localStorage.setItem("xxsy_guid", c_guid); return }; if (c_guid == null || c_guid == "") { if (l_guid != null && l_guid != "") { c_guid = l_guid; statcookie('xxsy_guid', c_guid, { path: '/', expires: 999 }) }; var statpage = getParameter("stat_page"); var statbookid = getParameter("bookid"); var actionname = location.pathname; if (!actionname || actionname == "/") statpage = "1_home_p1"; var data = JSON.stringify({ Method: 'stats_guid', Parameters: { guid: c_guid, actionname: actionname, statpage: statpage, bookid: statbookid } }); ajax('/Service/ServiceMethod?requestData=' + encodeURIComponent(data), function (data) { if (data != '') { var res = eval('(' + data + ')'); if (res) { if (res.Guid != '' && res.Guid != c_guid) { statcookie('xxsy_guid', res.Guid, { path: '/', expires: 999 }); localStorage.setItem("xxsy_guid", res.Guid) } } } }) } } catch (e) { console.log(e.message, e.name, e.stack) } })();